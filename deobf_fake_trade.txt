-- Visual Trade Manipulator / Fake Trade GUI for Adopt Me
-- Works in Delta Executor (mobile/PC) with draggable panel

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Main GUI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "TradeRequestButton"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local MainFrame = Instance.new("Frame")
MainFrame.Name = "TradeControlPanel"
MainFrame.Size = UDim2.new(0, 180, 0, 320)
MainFrame.Position = UDim2.new(0, 10, 0, 100)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
MainFrame.BackgroundTransparency = 0.1
MainFrame.BorderSizePixel = 0
MainFrame.ZIndex = 5

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 12)
Corner.Parent = MainFrame

local Stroke = Instance.new("UIStroke")
Stroke.Color = Color3.fromRGB(60, 60, 80)
Stroke.Thickness = 2
Stroke.Parent = MainFrame

MainFrame.Parent = ScreenGui

-- Make MainFrame draggable (mouse + touch/thumb support)
local dragging = false
local dragInput = nil
local dragStart = nil
local startPos = nil

local function update(input)
    if not dragging then return end
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
end

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

RunService.Heartbeat:Connect(function()
    if dragInput then
        update(dragInput)
    end
end)

-- Start Trade Button
local StartTradeButton = Instance.new("TextButton")
StartTradeButton.Name = "StartVisualTradeRequest"
StartTradeButton.Size = UDim2.new(0, 160, 0, 35)
StartTradeButton.Position = UDim2.new(0, 10, 0, 10)
StartTradeButton.BackgroundColor3 = Color3.fromRGB(85, 170, 85)
StartTradeButton.BorderSizePixel = 0
StartTradeButton.Text = "START TRADE (5)"
StartTradeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
StartTradeButton.Font = Enum.Font.GothamBold
StartTradeButton.TextSize = 14
StartTradeButton.ZIndex = 10

Instance.new("UICorner", StartTradeButton).CornerRadius = UDim.new(0, 8)
Instance.new("UIStroke", StartTradeButton).Color = Color3.fromRGB(60, 140, 60)
Instance.new("UIStroke", StartTradeButton).Thickness = 2
StartTradeButton.Parent = MainFrame

-- Spectator Count Buttons (1-5)
local SpectatorFrame = Instance.new("Frame")
SpectatorFrame.Name = "SpectatorSelection"
SpectatorFrame.Size = UDim2.new(0, 160, 0, 25)
SpectatorFrame.Position = UDim2.new(0, 10, 0, 50)
SpectatorFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
SpectatorFrame.BackgroundTransparency = 0.1
SpectatorFrame.BorderSizePixel = 0
SpectatorFrame.ZIndex = 10

Instance.new("UICorner", SpectatorFrame).CornerRadius = UDim.new(0, 6)
SpectatorFrame.Parent = MainFrame

local SpectatorButtons = {}
for i = 1, 5 do
    local button = Instance.new("TextButton")
    button.Name = "Spectator" .. i
    button.Size = UDim2.new(0, 28, 0, 20)
    button.Position = UDim2.new(0, 5 + (i - 1) * 31, 0, 2)
    button.BackgroundColor3 = i == 5 and Color3.fromRGB(85, 170, 85) or Color3.fromRGB(80, 80, 80)
    button.Text = tostring(i)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.GothamBold
    button.TextSize = 10
    button.ZIndex = 11

    Instance.new("UICorner", button).CornerRadius = UDim.new(0, 4)
    button.Parent = SpectatorFrame
    SpectatorButtons[i] = button
end

-- Add Pet Button
local AddPetButton = Instance.new("TextButton")
AddPetButton.Name = "AddRandomPetButton"
AddPetButton.Size = UDim2.new(0, 160, 0, 25)
AddPetButton.Position = UDim2.new(0, 10, 0, 80)
AddPetButton.BackgroundColor3 = Color3.fromRGB(220, 120, 50)
AddPetButton.Text = "ADD PET"
AddPetButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AddPetButton.Font = Enum.Font.GothamBold
AddPetButton.TextSize = 11
AddPetButton.ZIndex = 10

Instance.new("UICorner", AddPetButton).CornerRadius = UDim.new(0, 6)
Instance.new("UIStroke", AddPetButton).Color = Color3.fromRGB(180, 80, 30)
AddPetButton.Parent = MainFrame

-- Remove Pet Button
local RemovePetButton = Instance.new("TextButton")
RemovePetButton.Name = "RemovePetButton"
RemovePetButton.Size = UDim2.new(0, 160, 0, 25)
RemovePetButton.Position = UDim2.new(0, 10, 0, 110)
RemovePetButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
RemovePetButton.Text = "REMOVE PET"
RemovePetButton.TextColor3 = Color3.fromRGB(255, 255, 255)
RemovePetButton.Font = Enum.Font.GothamBold
RemovePetButton.TextSize = 11
RemovePetButton.ZIndex = 10

Instance.new("UICorner", RemovePetButton).CornerRadius = UDim.new(0, 6)
Instance.new("UIStroke", RemovePetButton).Color = Color3.fromRGB(150, 40, 40)
RemovePetButton.Parent = MainFrame

-- Player Selection Section
local PlayerSelectionFrame = Instance.new("Frame")
PlayerSelectionFrame.Name = "PlayerSelectionSection"
PlayerSelectionFrame.Size = UDim2.new(0, 160, 0, 150)
PlayerSelectionFrame.Position = UDim2.new(0, 10, 0, 140)
PlayerSelectionFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
PlayerSelectionFrame.BorderSizePixel = 0
PlayerSelectionFrame.ZIndex = 10

Instance.new("UICorner", PlayerSelectionFrame).CornerRadius = UDim.new(0, 8)
Instance.new("UIStroke", PlayerSelectionFrame).Color = Color3.fromRGB(70, 70, 90)
PlayerSelectionFrame.Parent = MainFrame

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "PlayerSelectTitle"
TitleLabel.Size = UDim2.new(1, 0, 0, 20)
TitleLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
TitleLabel.Text = "SELECT PLAYER"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextSize = 11
TitleLabel.ZIndex = 11
Instance.new("UICorner", TitleLabel).CornerRadius = UDim.new(0, 8)
TitleLabel.Parent = PlayerSelectionFrame

local PlayerListScrolling = Instance.new("ScrollingFrame")
PlayerListScrolling.Name = "PlayerList"
PlayerListScrolling.Size = UDim2.new(1, -10, 1, -25)
PlayerListScrolling.Position = UDim2.new(0, 5, 0, 20)
PlayerListScrolling.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
PlayerListScrolling.ScrollBarThickness = 4
PlayerListScrolling.ZIndex = 11
PlayerListScrolling.Parent = PlayerSelectionFrame

local ListLayout = Instance.new("UIListLayout")
ListLayout.Padding = UDim.new(0, 2)
ListLayout.Parent = PlayerListScrolling

-- Selected Player Display
local SelectedPlayerNameLabel = Instance.new("TextLabel")
SelectedPlayerNameLabel.Name = "SelectedPlayerLabel"
SelectedPlayerNameLabel.Size = UDim2.new(0, 160, 0, 15)
SelectedPlayerNameLabel.Position = UDim2.new(0, 10, 0, 295)
SelectedPlayerNameLabel.BackgroundTransparency = 1
SelectedPlayerNameLabel.Text = "AdoptMe_Fan"
SelectedPlayerNameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
SelectedPlayerNameLabel.Font = Enum.Font.Gotham
SelectedPlayerNameLabel.TextSize = 10
SelectedPlayerNameLabel.ZIndex = 10
SelectedPlayerNameLabel.Parent = MainFrame

local SelectedPlayerIdLabel = Instance.new("TextLabel")
SelectedPlayerIdLabel.Name = "SelectedPlayerIdLabel"
SelectedPlayerIdLabel.Size = UDim2.new(0, 160, 0, 12)
SelectedPlayerIdLabel.Position = UDim2.new(0, 10, 0, 310)
SelectedPlayerIdLabel.BackgroundTransparency = 1
SelectedPlayerIdLabel.Text = "ID: 123456"
SelectedPlayerIdLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
SelectedPlayerIdLabel.Font = Enum.Font.Gotham
SelectedPlayerIdLabel.TextSize = 9
SelectedPlayerIdLabel.ZIndex = 10
SelectedPlayerIdLabel.Parent = MainFrame

-- Script State
local SelectedSpectatorCount = 5
local SelectedPlayerName = "AdoptMe_Fan"
local SelectedPlayerId = 123456

local ValuablePetsList = {
    "ugc_refresh_2023_african_wild_dog",
    "albino_monkey",
    "arctic_reindeer",
    "summerfest_2024_balloon_unicorn",
    "bat_dragon",
    "lures_2023_blazing_lion",
    "easter_2024_candyfloss_chick",
    "crow",
    "frost_dragon",
    "giraffe",
    "pride_2022_goat",
    "springfest_2023_hare",
    "elf_hedgehog",
    "owl",
    "parrot",
    "winter_2023_peppermint_penguin",
    "shadow_dragon",
    "summerfest_2023",
    "meme_2023_sheeeeep",
    "winter_2022_strawberry_shortcake_bat_dragon"
}

-- Update spectator count selection
local function UpdateSpectatorCount(count)
    SelectedSpectatorCount = count
    StartTradeButton.Text = "START TRADE (" .. count .. ")"
    for i = 1, 5 do
        SpectatorButtons[i].BackgroundColor3 = i == count and Color3.fromRGB(85, 170, 85) or Color3.fromRGB(80, 80, 80)
    end
end

for i = 1, 5 do
    SpectatorButtons[i].MouseButton1Click:Connect(function()
        UpdateSpectatorCount(i)
    end)
end

-- Refresh player list in UI
local function RefreshPlayerList()
    for _, child in ipairs(PlayerListScrolling:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end

    for _, player in ipairs(Players:GetPlayers()) do
        if player \~= LocalPlayer then
            local btn = Instance.new("TextButton")
            btn.Name = "Player_" .. player.UserId
            btn.Size = UDim2.new(1, 0, 0, 30)
            btn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
            btn.Text = player.Name
            btn.TextColor3 = Color3.fromRGB(255, 255, 255)
            btn.Font = Enum.Font.Gotham
            btn.TextSize = 10
            btn.TextWrapped = true
            btn.ZIndex = 12
            Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 4)

            btn.MouseButton1Click:Connect(function()
                SelectedPlayerName = player.Name
                SelectedPlayerId = player.UserId
                SelectedPlayerNameLabel.Text = SelectedPlayerName
                SelectedPlayerIdLabel.Text = "ID: " .. SelectedPlayerId
                print("Selected player: " .. SelectedPlayerName .. " (ID: " .. SelectedPlayerId .. ")")
            end)

            btn.Parent = PlayerListScrolling
        end
    end

    local presetPlayers = {
        { Name = "cammyxboba", UserId = 901819690 },
        { Name = "rainbowriley321", UserId = 154241943 },
        { Name = "roplexyoutube", UserId = 1676706728 },
        { Name = "j3llynoah", UserId = 9190499461 }
    }

    for _, data in ipairs(presetPlayers) do
        local btn = Instance.new("TextButton")
        btn.Name = "Custom_" .. data.Name
        btn.Size = UDim2.new(1, 0, 0, 30)
        btn.BackgroundColor3 = Color3.fromRGB(85, 107, 47)
        btn.Text = data.Name
        btn.TextColor3 = Color3.fromRGB(255, 255, 255)
        btn.Font = Enum.Font.Gotham
        btn.TextSize = 10
        btn.TextWrapped = true
        btn.ZIndex = 12
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 4)

        btn.MouseButton1Click:Connect(function()
            SelectedPlayerName = data.Name
            SelectedPlayerId = data.UserId
            SelectedPlayerNameLabel.Text = SelectedPlayerName
            SelectedPlayerIdLabel.Text = "ID: " .. SelectedPlayerId
            print("Selected custom player: " .. SelectedPlayerName .. " (ID: " .. SelectedPlayerId .. ")")
        end)

        btn.Parent = PlayerListScrolling
    end

    PlayerListScrolling.CanvasSize = UDim2.new(0, 0, 0, ListLayout.AbsoluteContentSize.Y)
end

RefreshPlayerList()

-- Add fake high-value pet to partner's offer
local function AddFakePetToPartnerOffer()
    local success, TradeApp = pcall(function()
        return require(game.ReplicatedStorage:WaitForChild("Fsys")).load("UIManager").apps.TradeApp
    end)
    
    if not success or not TradeApp then
        print("TradeApp not found or error loading Fsys")
        return
    end

    local tradeState = TradeApp:_get_local_trade_state()
    if not tradeState then
        print("No active trade found! Start a trade first.")
        return
    end

    local partnerItems = tradeState.sender_offer.items or {}
    local randomPetKind = ValuablePetsList[math.random(1, #ValuablePetsList)]

    local petTiers = {
        { mega_neon = true, flyable = true, rideable = true },
        { neon = true, flyable = true, rideable = true },
        { flyable = true, rideable = true }
    }
    local randomTier = petTiers[math.random(1, #petTiers)]

    local fakePet = {
        unique = "pet_" .. randomPetKind .. "_" .. math.random(10000, 99999),
        category = "pets",
        kind = randomPetKind,
        properties = randomTier
    }

    table.insert(partnerItems, fakePet)

    TradeApp:_change_local_trade_state({
        sender_offer = {
            items = partnerItems,
            negotiated = tradeState.sender_offer.negotiated,
            confirmed = tradeState.sender_offer.confirmed,
            player_name = tradeState.sender_offer.player_name
        }
    })

    TradeApp:refresh_all()
    TradeApp:_lock_trade_for_appropriate_time()

    local prefix = randomTier.mega_neon and "MFR" or (randomTier.neon and "NFR" or "FR")
    local displayName = randomPetKind:gsub("_", " "):gsub("(%a)([%w_]*)", function(a, b) return a:upper() .. b:lower() end)

    TradeApp:_render_message_in_trade_chat(nil, SelectedPlayerName .. " added " .. prefix .. " " .. displayName, false, true)
    print("Added " .. prefix .. " " .. randomPetKind .. " to partner's offer!")
end

-- Remove last pet from partner's offer
local function RemoveLastPetFromPartnerOffer()
    local success, TradeApp = pcall(function()
        return require(game.ReplicatedStorage:WaitForChild("Fsys")).load("UIManager").apps.TradeApp
    end)
    
    if not success or not TradeApp then
        print("TradeApp not found or error loading Fsys")
        return
    end

    local tradeState = TradeApp:_get_local_trade_state()
    if not tradeState then
        print("No active trade found!")
        return
    end

    local partnerItems = tradeState.sender_offer.items or {}
    if #partnerItems == 0 then
        print("No pets to remove!")
        return
    end

    local removedPet = table.remove(partnerItems)

    TradeApp:_change_local_trade_state({
        sender_offer = {
            items = partnerItems,
            negotiated = tradeState.sender_offer.negotiated,
            confirmed = tradeState.sender_offer.confirmed,
            player_name = tradeState.sender_offer.player_name
        }
    })

    TradeApp:refresh_all()
    TradeApp:_lock_trade_for_appropriate_time()

    local prefix = removedPet.properties.mega_neon and "MFR" or (removedPet.properties.neon and "NFR" or "FR")
    local displayName = removedPet.kind:gsub("_", " "):gsub("(%a)([%w_]*)", function(a, b) return a:upper() .. b:lower() end)

    TradeApp:_render_message_in_trade_chat(nil, SelectedPlayerName .. " removed " .. prefix .. " " .. displayName, false, true)
    print("Removed " .. prefix .. " " .. removedPet.kind .. " from partner's offer!")
end

-- Button connections
AddPetButton.MouseButton1Click:Connect(AddFakePetToPartnerOffer)
RemovePetButton.MouseButton1Click:Connect(RemoveLastPetFromPartnerOffer)

-- Start the fake/visual trade
local function StartFakeTrade()
    local success, Fsys = pcall(function()
        return require(game.ReplicatedStorage:WaitForChild("Fsys"))
    end)
    
    if not success then
        print("Fsys not found!")
        return
    end

    local fakeTargetPlayer = {
        Name = SelectedPlayerName,
        UserId = SelectedPlayerId,
        DisplayName = SelectedPlayerName
    }

    local UIManager = Fsys.load("UIManager")
    local TradeApp = UIManager.apps.TradeApp

    if not TradeApp then
        print("TradeApp not found")
        return
    end

    local emptyTradeState = {
        trade_id = "visual_trade_" .. math.random(10000, 99999),
        sender = fakeTargetPlayer,
        recipient = LocalPlayer,
        sender_offer = { items = {}, negotiated = false, confirmed = false, player_name = fakeTargetPlayer.Name },
        recipient_offer = { items = {}, negotiated = false, confirmed = false, player_name = LocalPlayer.Name },
        current_stage = "negotiation",
        offer_version = 1,
        sender_has_trade_license = true,
        recipient_has_trade_license = true,
        busy_indicators = {},
        subscriber_count = SelectedSpectatorCount
    }

    print("Starting visual trade with " .. SelectedPlayerName .. " (" .. SelectedSpectatorCount .. " spectators)")
    TradeApp:_overwrite_local_trade_state(emptyTradeState)
    UIManager.set_app_visibility("TradeApp", true)
    wait(0.5)
    TradeApp:refresh_all()

    -- (Rest of the original hijack logic can be added here if needed - auto accept/confirm, remove override, etc.)
    -- For now keeping it minimal as many parts rely on exact game functions that may change
end

StartTradeButton.MouseButton1Click:Connect(StartFakeTrade)

print("Visual Trade GUI loaded! Drag the panel with mouse or finger. Click START TRADE to begin.")
